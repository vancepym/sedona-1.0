//
// Copyright (c) 2007 Tridium, Inc
// Licensed under the Academic Free License version 3.0
//
// History:
//   17 May 07  Andy Sunders  Creation
//

**
** TickTockTest
**
class TickTockTest
  extends Test
{
  static inline TickTock tickTock
  static inline Freq freq

  static void test()
  {
    // not in an app, so call this explicitly
    tickTock.start()
    freq.start()

    validate(7)
  }

  static void validate(int pps)
  {
    //tickTock.execute()
    bool curOut = tickTock.out
    bool lastOut = curOut
    int count = 0;
    freq.in = curOut
    long startTime = Sys.ticks()
    tickTock.ticksPerSec = pps
    //while(t1.compare(1100ms) == -1)
    while(count < pps || curOut)
    {
      tickTock.execute()
      curOut = tickTock.out
      if(curOut)
      {
        if(curOut != lastOut)
        {
          count++
          //Sys.out.printInt(count).print("-")
        }
      }
      lastOut = curOut
      freq.in = curOut
      freq.execute()
      //t1.now()
      //t1.sub(t1, now)
    }
    long deltaTime = Sys.ticks() - startTime
    freq.execute()
    Sys.out.print("    ticks/sec = ").printInt(pps).nl()
    Sys.out.print("    count = ").printInt(count).nl()
    Sys.out.print("    time = ").printInt((int)deltaTime).nl()
    Sys.out.print("    freq.pps = ").printFloat(freq.pps).nl()
    Sys.out.print("    freq.ppm = ").printFloat(freq.ppm).nl()
    assert(count == pps)
    assert(deltaTime < 1050ms)
    assert(deltaTime > 950ms)
    //assert(freq.pps == 1.0f)
    //assert(freq.ppm == 60.0f)

  }




}
